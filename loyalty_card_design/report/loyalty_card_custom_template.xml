<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="gift_card_custom_report" model="ir.actions.report">
        <field name="name">Gift Card Custom Report</field>
        <field name="model">loyalty.card</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">loyalty_card_design.custom_gift_card_template</field>
        <field name="report_file">loyalty_card_design.custom_gift_card_template</field>
        <field name="binding_model_id" ref="loyalty.model_loyalty_card"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="paperformat_gift_card_custom"/>
    </record>


    <template id="report_loyalty_gift_card_document">
        <t t-call="web.basic_layout">
            <t t-call="web.html_container">
                <div class="mainpage" style="
                        padding-top: 5%;
                        margin-bottom: 5%;
                        padding-left: 3%;
                        padding-right: 3%;
                        position: relative;
                        page-break-after: always;
                        max-height: 838pt;
                        font-size: medium;">
                    <t t-if="o.program_id.gift_card_header">
                    <t t-set="img_header" t-value="image_data_uri(o.program_id.gift_card_header)"/>
                        <div class="customized_header" t-attf-style="display: flex;
                            width: 100%;
                            min-width: 100%;
                            min-height: 20em;
                            max-height: 20em;
                            background-size: contain;background-image:url({{img_header}}); background-repeat: no-repeat;">
                            <t style="background-color: rgba(0, 255, 255, 0);
                            max-height: 6em;
                            margin-left: -5.2%;
                            margin-top: -6em;
                            z-index: 20;
                            min-height: 6em;
                            position: relative;
                            max-width: 105.5%;
                            min-width: 105.5%;">
                            </t>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="customized_header" t-attf-style="display: flex;
                                width: 100%;
                                min-width: 100%;
                                min-height: 19em;
                                max-height: 19em;
                                background-size: cover;">
                            <t style="background-color: rgba(0, 255, 255, 0);
                            max-height: 6em;
                            margin-left: -5.2%;
                            margin-top: -6em;
                            z-index: 20;
                            min-height: 6em;
                            position: relative;
                            max-width: 105.5%;
                            min-width: 105.5%;"/>
                        </div>
                    </t>
                    <div class="div_customized_title_and_balance" style="
                            margin-left: -5.2%;
                            margin-top: -9.2em;
                            z-index: 20;
                            min-height: 6em;
                            max-height: 6em;
                            position: relative;
                            max-width: 100%;
                            min-width: 100%;">
                            <div class="customized_title" style="padding-left: 10%;
                                background-color: #ffffff;
                                padding-right: 15%;
                                min-height: inherit;
                                width: 83%;
                                float: left;
                                position: relative;">

                                <p class="customized_title" style="font-weight: bold;
                                    font-size: 21px;
                                    text-transform: uppercase;
                                    position: absolute;
                                    top: 35%;">
                                    <t t-if="o.program_id.title">
                                        <p t-esc="o.program_id.title" t-attf-style="font-weight: bold;
                                            font-size: 20px;
                                            text-transform: uppercase;
                                            position: absolute;
                                            top: 35%;
                                            color: #{o.program_id.title_text_color}"/>
                                    </t>
                                </p>
                            
                            </div>
                            <t t-if="o.program_id.balance">
                                <div class="div_show_balance">
                                    <center>
                                        <div class="balance">
                                            <p style="font-size:20px;font-weight:bold;text-align:center">
                                                Amount
                                                <strong><span t-out="o.points" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}">1000</span></strong>
                                            </p>
                                        </div>
                                    </center>
                                </div>
                            </t>
                    </div>
                    <t t-if="o.program_id.gift_card_description_image">
                    <t t-set="img_description" t-value="image_data_uri(o.program_id.gift_card_description_image)"/>
                        <div class="div_description_card" t-attf-style="display: flex;
                            width: 100%;
                            min-width: 100%;
                            min-height: 20em;
                            max-height: 20em;
                            background-size: contain;background-image:url({{img_description}); background-repeat: no-repeat;">

                            <t t-esc="o.program_id.description" style="line-height: normal"/>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="div_description_card" t-attf-style="
                            min-width: 100%;
                            max-height: 16.5em;
                            min-height: 16.5em;
                            padding-left: 5%;
                            padding-right: 5%;
                            background-size: contain;
                            background-repeat: no-repeat;
                            line-height: normal">

                            
                            <t t-esc="o.program_id.description" style="line-height: normal"/>

                        </div>
                    </t>
                    <div style="min-height: 9em;
                        max-height: 9em;
                        padding: 1%;
                        width: 100%;">

                        <div class="code_validity" style="padding: 2% 7% 2% 4%;
                            font-size: 15px;
                            min-width: 50%;
                            max-width: 50%;
                            min-height: 100%;
                            float: left;">

                                <t t-if="o.expiration_date">
                                Code to be used when ordering online or at the counter before
                                        <b>
                                         <t t-esc="o.expiration_date.strftime('%d/%m/%Y')"/>
                                        </b>
                                        <br></br>
                                </t>
                                <p style="font-size: 18px;
                                        font-weight: bold;">
                                    <span t-field="o.code"/>
                                </p>
                                

                        </div>
                                
                                <div class="div_barcode" style="min-width: 50%;
                                    max-width: 50%;
                                    min-height: 100%;
                                    float: left;
                                    background-color: white;
                                    padding: 2% 2% 2% 2%;">
                                    <center>
                                        <div class="barcode">
                                            <img class="barcode_img" t-att-src="'/report/barcode/Code128/'+o.code" style="width:300px;height:50px" alt="Barcode"/>
                                        </div>
                                        <div class="div_warning">
                                            <b class="warning_barcode" style="text-align:center; margin-top: 4px">This code is not a ticket</b>
                                        </div>
                                    </center>
                                    
                                </div>
                    </div>
                    <br></br>
                    <div style="
                            min-width: 100%;
                            min-height: 17em;
                            max-height: 17em;
                            line-height: normal">
                        <t t-esc="o.program_id.condition" style="line-height: normal"/>
                    </div>
                    <div class="div_footer" style="min-height: 3em;
                        max-height: 3em;
                        width: 100%;
                        color: #445161;">
                        <hr></hr>
                        <ul style="list-style-type: none;
                            margin: 0;
                            padding: 0;
                            overflow: hidden;">
                            <li style="float: left;
                                font-size: 8px;">
                                <t t-esc="o.company_id.name"/>
                            </li>
                            <li style="margin-left: 16px;font-size: 8px;float: left;">
                                <t t-esc="o.company_id.street"/>
                            </li>
                            <li style="margin-left: 16px;font-size: 8px;float: left;">
                                <t t-esc="o.company_id.street2"/>,
                                <t t-esc="o.company_id.zip"/>
                                <t t-esc="o.company_id.city"/>
                            </li>
                            <li style="margin-left: 16px;font-size: 8px;float: left;">
                                <t t-esc="o.company_id.email"/>
                            </li>
                            <li style="margin-left: 16px;font-size: 8px;float: left;">
                                <t t-esc="o.company_id.phone"/>
                            </li>
                            <li style="margin-left: 16px;font-size: 8px;float: left;">
                                <t t-esc="o.company_id.vat"/>
                            </li>
                        </ul>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <template id="custom_gift_card_template">
        <t t-foreach="docs" t-as="o">
            <t t-call="loyalty_card_design.report_loyalty_gift_card_document" t-lang="o._get_mail_partner().lang or o.env.lang"/>
        </t>
    </template>
    
</odoo>
